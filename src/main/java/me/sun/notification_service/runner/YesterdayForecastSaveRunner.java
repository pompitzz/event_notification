package me.sun.notification_service.runner;

import com.fasterxml.jackson.databind.ObjectMapper;
import lombok.RequiredArgsConstructor;
import me.sun.notification_service.crawler.forecast.dto.response.ForecastResponse;
import me.sun.notification_service.crawler.forecast.dto.response.ResponseDto;
import me.sun.notification_service.service.query.ForecastQueryService;
import org.springframework.boot.ApplicationArguments;
import org.springframework.boot.ApplicationRunner;
import org.springframework.core.annotation.Order;
import org.springframework.stereotype.Component;

import java.util.List;

@Order(1)
@Component
@RequiredArgsConstructor
public class YesterdayForecastSaveRunner implements ApplicationRunner {

    private final ForecastQueryService forecastQueryService;
    private final ObjectMapper objectMapper;

    @Override
    public void run(ApplicationArguments args) throws Exception {
        String json = "{\"response\":{\"header\":{\"resultCode\":\"00\",\"resultMsg\":\"NORMAL_SERVICE\"},\"body\":{\"dataType\":\"JSON\",\"items\":{\"item\":[{\"baseDate\":\"20200619\",\"baseTime\":\"0800\",\"category\":\"POP\",\"fcstDate\":\"20200619\",\"fcstTime\":\"1200\",\"fcstValue\":\"20\",\"nx\":62,\"ny\":126},{\"baseDate\":\"20200619\",\"baseTime\":\"0800\",\"category\":\"PTY\",\"fcstDate\":\"20200619\",\"fcstTime\":\"1200\",\"fcstValue\":\"0\",\"nx\":62,\"ny\":126},{\"baseDate\":\"20200619\",\"baseTime\":\"0800\",\"category\":\"R06\",\"fcstDate\":\"20200619\",\"fcstTime\":\"1200\",\"fcstValue\":\"0\",\"nx\":62,\"ny\":126},{\"baseDate\":\"20200619\",\"baseTime\":\"0800\",\"category\":\"REH\",\"fcstDate\":\"20200619\",\"fcstTime\":\"1200\",\"fcstValue\":\"50\",\"nx\":62,\"ny\":126},{\"baseDate\":\"20200619\",\"baseTime\":\"0800\",\"category\":\"S06\",\"fcstDate\":\"20200619\",\"fcstTime\":\"1200\",\"fcstValue\":\"0\",\"nx\":62,\"ny\":126},{\"baseDate\":\"20200619\",\"baseTime\":\"0800\",\"category\":\"SKY\",\"fcstDate\":\"20200619\",\"fcstTime\":\"1200\",\"fcstValue\":\"3\",\"nx\":62,\"ny\":126},{\"baseDate\":\"20200619\",\"baseTime\":\"0800\",\"category\":\"T3H\",\"fcstDate\":\"20200619\",\"fcstTime\":\"1200\",\"fcstValue\":\"29\",\"nx\":62,\"ny\":126},{\"baseDate\":\"20200619\",\"baseTime\":\"0800\",\"category\":\"UUU\",\"fcstDate\":\"20200619\",\"fcstTime\":\"1200\",\"fcstValue\":\"1.1\",\"nx\":62,\"ny\":126},{\"baseDate\":\"20200619\",\"baseTime\":\"0800\",\"category\":\"VEC\",\"fcstDate\":\"20200619\",\"fcstTime\":\"1200\",\"fcstValue\":\"213\",\"nx\":62,\"ny\":126},{\"baseDate\":\"20200619\",\"baseTime\":\"0800\",\"category\":\"VVV\",\"fcstDate\":\"20200619\",\"fcstTime\":\"1200\",\"fcstValue\":\"1.7\",\"nx\":62,\"ny\":126},{\"baseDate\":\"20200619\",\"baseTime\":\"0800\",\"category\":\"WSD\",\"fcstDate\":\"20200619\",\"fcstTime\":\"1200\",\"fcstValue\":\"2\",\"nx\":62,\"ny\":126},{\"baseDate\":\"20200619\",\"baseTime\":\"0800\",\"category\":\"POP\",\"fcstDate\":\"20200619\",\"fcstTime\":\"1500\",\"fcstValue\":\"20\",\"nx\":62,\"ny\":126},{\"baseDate\":\"20200619\",\"baseTime\":\"0800\",\"category\":\"PTY\",\"fcstDate\":\"20200619\",\"fcstTime\":\"1500\",\"fcstValue\":\"0\",\"nx\":62,\"ny\":126},{\"baseDate\":\"20200619\",\"baseTime\":\"0800\",\"category\":\"REH\",\"fcstDate\":\"20200619\",\"fcstTime\":\"1500\",\"fcstValue\":\"45\",\"nx\":62,\"ny\":126},{\"baseDate\":\"20200619\",\"baseTime\":\"0800\",\"category\":\"SKY\",\"fcstDate\":\"20200619\",\"fcstTime\":\"1500\",\"fcstValue\":\"3\",\"nx\":62,\"ny\":126},{\"baseDate\":\"20200619\",\"baseTime\":\"0800\",\"category\":\"T3H\",\"fcstDate\":\"20200619\",\"fcstTime\":\"1500\",\"fcstValue\":\"30\",\"nx\":62,\"ny\":126},{\"baseDate\":\"20200619\",\"baseTime\":\"0800\",\"category\":\"TMX\",\"fcstDate\":\"20200619\",\"fcstTime\":\"1500\",\"fcstValue\":\"31.0\",\"nx\":62,\"ny\":126},{\"baseDate\":\"20200619\",\"baseTime\":\"0800\",\"category\":\"UUU\",\"fcstDate\":\"20200619\",\"fcstTime\":\"1500\",\"fcstValue\":\"3.1\",\"nx\":62,\"ny\":126},{\"baseDate\":\"20200619\",\"baseTime\":\"0800\",\"category\":\"VEC\",\"fcstDate\":\"20200619\",\"fcstTime\":\"1500\",\"fcstValue\":\"259\",\"nx\":62,\"ny\":126},{\"baseDate\":\"20200619\",\"baseTime\":\"0800\",\"category\":\"VVV\",\"fcstDate\":\"20200619\",\"fcstTime\":\"1500\",\"fcstValue\":\"0.6\",\"nx\":62,\"ny\":126},{\"baseDate\":\"20200619\",\"baseTime\":\"0800\",\"category\":\"WSD\",\"fcstDate\":\"20200619\",\"fcstTime\":\"1500\",\"fcstValue\":\"3.2\",\"nx\":62,\"ny\":126},{\"baseDate\":\"20200619\",\"baseTime\":\"0800\",\"category\":\"POP\",\"fcstDate\":\"20200619\",\"fcstTime\":\"1800\",\"fcstValue\":\"20\",\"nx\":62,\"ny\":126},{\"baseDate\":\"20200619\",\"baseTime\":\"0800\",\"category\":\"PTY\",\"fcstDate\":\"20200619\",\"fcstTime\":\"1800\",\"fcstValue\":\"0\",\"nx\":62,\"ny\":126},{\"baseDate\":\"20200619\",\"baseTime\":\"0800\",\"category\":\"R06\",\"fcstDate\":\"20200619\",\"fcstTime\":\"1800\",\"fcstValue\":\"0\",\"nx\":62,\"ny\":126},{\"baseDate\":\"20200619\",\"baseTime\":\"0800\",\"category\":\"REH\",\"fcstDate\":\"20200619\",\"fcstTime\":\"1800\",\"fcstValue\":\"50\",\"nx\":62,\"ny\":126},{\"baseDate\":\"20200619\",\"baseTime\":\"0800\",\"category\":\"S06\",\"fcstDate\":\"20200619\",\"fcstTime\":\"1800\",\"fcstValue\":\"0\",\"nx\":62,\"ny\":126},{\"baseDate\":\"20200619\",\"baseTime\":\"0800\",\"category\":\"SKY\",\"fcstDate\":\"20200619\",\"fcstTime\":\"1800\",\"fcstValue\":\"3\",\"nx\":62,\"ny\":126},{\"baseDate\":\"20200619\",\"baseTime\":\"0800\",\"category\":\"T3H\",\"fcstDate\":\"20200619\",\"fcstTime\":\"1800\",\"fcstValue\":\"28\",\"nx\":62,\"ny\":126},{\"baseDate\":\"20200619\",\"baseTime\":\"0800\",\"category\":\"UUU\",\"fcstDate\":\"20200619\",\"fcstTime\":\"1800\",\"fcstValue\":\"2.7\",\"nx\":62,\"ny\":126},{\"baseDate\":\"20200619\",\"baseTime\":\"0800\",\"category\":\"VEC\",\"fcstDate\":\"20200619\",\"fcstTime\":\"1800\",\"fcstValue\":\"268\",\"nx\":62,\"ny\":126},{\"baseDate\":\"20200619\",\"baseTime\":\"0800\",\"category\":\"VVV\",\"fcstDate\":\"20200619\",\"fcstTime\":\"1800\",\"fcstValue\":\"0.1\",\"nx\":62,\"ny\":126},{\"baseDate\":\"20200619\",\"baseTime\":\"0800\",\"category\":\"WSD\",\"fcstDate\":\"20200619\",\"fcstTime\":\"1800\",\"fcstValue\":\"2.7\",\"nx\":62,\"ny\":126},{\"baseDate\":\"20200619\",\"baseTime\":\"0800\",\"category\":\"POP\",\"fcstDate\":\"20200619\",\"fcstTime\":\"2100\",\"fcstValue\":\"0\",\"nx\":62,\"ny\":126},{\"baseDate\":\"20200619\",\"baseTime\":\"0800\",\"category\":\"PTY\",\"fcstDate\":\"20200619\",\"fcstTime\":\"2100\",\"fcstValue\":\"0\",\"nx\":62,\"ny\":126},{\"baseDate\":\"20200619\",\"baseTime\":\"0800\",\"category\":\"REH\",\"fcstDate\":\"20200619\",\"fcstTime\":\"2100\",\"fcstValue\":\"65\",\"nx\":62,\"ny\":126},{\"baseDate\":\"20200619\",\"baseTime\":\"0800\",\"category\":\"SKY\",\"fcstDate\":\"20200619\",\"fcstTime\":\"2100\",\"fcstValue\":\"1\",\"nx\":62,\"ny\":126},{\"baseDate\":\"20200619\",\"baseTime\":\"0800\",\"category\":\"T3H\",\"fcstDate\":\"20200619\",\"fcstTime\":\"2100\",\"fcstValue\":\"25\",\"nx\":62,\"ny\":126},{\"baseDate\":\"20200619\",\"baseTime\":\"0800\",\"category\":\"UUU\",\"fcstDate\":\"20200619\",\"fcstTime\":\"2100\",\"fcstValue\":\"1\",\"nx\":62,\"ny\":126},{\"baseDate\":\"20200619\",\"baseTime\":\"0800\",\"category\":\"VEC\",\"fcstDate\":\"20200619\",\"fcstTime\":\"2100\",\"fcstValue\":\"259\",\"nx\":62,\"ny\":126},{\"baseDate\":\"20200619\",\"baseTime\":\"0800\",\"category\":\"VVV\",\"fcstDate\":\"20200619\",\"fcstTime\":\"2100\",\"fcstValue\":\"0.2\",\"nx\":62,\"ny\":126}]},\"pageNo\":1,\"numOfRows\":40,\"totalCount\":216}}}";
        final ResponseDto responseDto = objectMapper.readValue(json, ResponseDto.class);
        final List<ForecastResponse> forecastResponses = responseDto.getForecast();

        forecastQueryService.saveForecasts(forecastResponses);
    }
}
